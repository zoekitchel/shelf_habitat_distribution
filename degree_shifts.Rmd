---
title: "Degree shifts"
output: html_notebook
---

Degree shifts

Second part of paper, if we move away from equator by 1 degree, how much habitat do we gain or lost

I need to look at shelf area by degrees latitude

```{r setup}
library(raster)
library(sf)
library(ncdf4)
library(rmapshaper)
library(tidyverse)
library(diptest)
library(moments)
library(viridis) #colors
library(data.table)
library(hydroTSM) #hypsometric curves
library(gridExtra)
library(maptools)
library(rgdal)
library(rgeos)
library(SpaDES)
library(rnaturalearth)
library(rnaturalearthdata)


etopo_shelf_df <- readRDS("~/Documents/grad school/Rutgers/Repositories/shelf_habitat_distribution/etopo_shelf_df.rds")
#bring in bathymetry data frame for shelf regions

#LMEs
LME_spdf <- readOGR("LME66/LMEs66.shp") #spatial points data frame with all 66 LMEs
head(LME_spdf)

#function to go from coordinates to minutes symbols in plots
scale_x_longitude <- function(xmin=-180, xmax=180, step=0.002, ...) {
  xbreaks <- seq(xmin,xmax,step)
  xlabels <- unlist(
    lapply(xbreaks, function(x){
      ifelse(x < 0, parse(text=paste0(paste0(abs(dms(x)$d), expression("*{degree}*")),
                                      paste0(abs(dms(x)$m), expression("*{minute}*")),
                                      paste0(abs(dms(x)$s)), expression("*{second}*W"))), 
             ifelse(x > 0, parse(text=paste0(paste0(abs(dms(x)$d), expression("*{degree}*")),
                                             paste0(abs(dms(x)$m), expression("*{minute}*")),
                                             paste0(abs(dms(x)$s)), expression("*{second}*E"))),
                    abs(dms(x))))}))
  return(scale_x_continuous("Longitude", breaks = xbreaks, labels = xlabels, expand = c(0, 0), ...))
}

scale_y_latitude <- function(ymin=-90, ymax=90, step=0.002, ...) {
  ybreaks <- seq(ymin,ymax,step)
  ylabels <- unlist(
    lapply(ybreaks, function(x){
      ifelse(x < 0, parse(text=paste0(paste0(abs(dms(x)$d), expression("*{degree}*")),
                                      paste0(abs(dms(x)$m), expression("*{minute}*")),
                                      paste0(abs(dms(x)$s)), expression("*{second}*S"))), 
             ifelse(x > 0, parse(text=paste0(paste0(abs(dms(x)$d), expression("*{degree}*")),
                                             paste0(abs(dms(x)$m), expression("*{minute}*")),
                                             paste0(abs(dms(x)$s)), expression("*{second}*N"))),
                    abs(dms(x))))}))
  return(scale_y_continuous("Latitude", breaks = ybreaks, labels = ylabels, expand = c(0, 0), ...))
} 
```

Make bathymetry data frame into raster (this takes a bit)
```{r bathy to raster}
proj <- crs(LME_spdf)
etopo_shelf_raster <- rasterFromXYZ(etopo_shelf_df, crs = proj)

```

Crop bathymetry raster to LME spdf (not sure if this is necessary, may just be able to use etopo shelf raster)
```{r}

#crop bathy layer to LME subset
LMEs_extent <- crop(etopo_shelf_raster, extent(LME_spdf))

#which areas of raster fall within borders of LMEs? (Don't know if I have to make LME specific)
#bathy_mask <- mask(LMEs_extent, LME_spdf)

```

Should go by projections of where species are moving:
"Marine species (~80% being ectotherms in the database; Extended Data Fig. 2) have moved towards the poles at a mean (±s.e.m.) pace of 5.92 ± 0.94 km yr−1 (one-sample Student’s t-test: t=6.26; d.f. residuals=23; P=2.20×10–6), which is almost six times faster than terrestrial species (one-way analysis of variance (ANOVA): F=12.68; d.f. factor=1; d.f. residuals=45; P=8.88×10–4)." Lenoir 2020

5.92 km * 10 = 59.2 km in 10 years

59.2 km is how many degrees?

1° = 111 km

so, 

```{r quick conversion}
59.2/111*1

```

0.5333˚ is representative of decadal shifts

I will put areas into 0.5˚ Bins (180 total degrees, so 180/0.5=360)

```{r}
180/0.5
```

How does continental shelf habitat change with latitude?

Plot Latitude by Area

Northern Hemisphere

```{r use data table to get bins}
etopo_shelf_dt <- as.data.table(etopo_shelf_df) #bathymetry into data table
etopo_shelf_dt_north <- etopo_shelf_dt[y >= 0,][,habitat := ifelse(is.na(layer), 0,1)] #if in northern hemisphere
setorder(etopo_shelf_dt_north, y)
etopo_shelf_dt_south <- etopo_shelf_dt[y <= 0,][,habitat := ifelse(is.na(layer), 0,1)] #if in southern hemisphere
setorder(etopo_shelf_dt_south, -y)
```

Binning data by 0.5 ˚
```{r}
etopo_shelf_dt_north_binned <- etopo_shelf_dt_north[,sum(habitat) , .(gr=cut(y,breaks=seq(0,90,by = (0.5))))]
etopo_shelf_dt_south_binned <- etopo_shelf_dt_south[,sum(habitat) , .(gr=cut(y,breaks=seq(0,-90,by = (-0.5))))]
```

Keep above because it's interesting global perspective (how does total shelf area vary by latitude)

However, makes more sense to look at by contiguous coast lines AND we don't actually need depth info TBH!

Eastern Atlantic (3)
-19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 58, 59, 60, 62

Western Atlantic (2)
- 5, 6, 7, 8, 9, 12, 14, 15, 16, 17, 18, 61, 63, 66

Eastern Pacific (1)
- 1, 2, 3, 4, 11, 13, 54, 55, 61, 65

Western Indian (4)
-30, 31, 32, 33

Eastern Indian (5)
-34, 38, 43, 44, 45

Western Pacific (6)
1,	35,	36,	37,	39,	40,	41,	42,	46,	47,	48,	49,	50,	51,	52,	53,	54,	56,	57,	65

Using Hailey's file which seems to line up

Merge LMEs into 6 LMEs

- keep in mind, LME 1 (1&6) and 54 (1&6) and 61 (1&2) and 65 (1&6) appear in multiple
```{r }
west_pac <- c(1,	35,	36,	37,	39,	40,	41,	42,	46,	47,	48,	49,	50,	51,	52,	53,	54,	56,	57,	65)
east_pac <- c(1, 2, 3, 4, 11, 13, 54, 55, 61, 65)
west_atl <- c(5, 6, 7, 8, 9, 12, 14, 15, 16, 17, 18, 61, 63, 66)
east_atl <- c(19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 58, 59, 60, 62)
west_ind <- c(30, 31, 32, 33)
east_ind <- c(34, 38, 43, 44, 45)

#subregions based on LME_number
west_pac_spdf <- LME_spdf[(LME_spdf$LME_NUMBER) %in% west_pac,]
east_pac_spdf <- LME_spdf[(LME_spdf$LME_NUMBER) %in% east_pac,]
west_atl_spdf <- LME_spdf[(LME_spdf$LME_NUMBER) %in% west_atl,]
west_ind_spdf <- LME_spdf[(LME_spdf$LME_NUMBER) %in% west_ind,]
east_atl_spdf <- LME_spdf[(LME_spdf$LME_NUMBER) %in% east_atl,]
east_ind_spdf <- LME_spdf[(LME_spdf$LME_NUMBER) %in% east_ind,]

#for subregions that span 360, we need to change CRS a bit
newCRS_west <- "+proj=longlat +datum=WGS84 +lon_wrap=180"
west_pac_spdf_shift <- spTransform(west_pac_spdf, CRS(newCRS_west))
west_pac_spdf_shift <- gBuffer(west_pac_spdf_shift, byid=TRUE, width=0) #gets rid of buffers, allows for union

newCRS_east <- "+proj=longlat +datum=WGS84 +lon_wrap=180"
east_pac_spdf_shift <- spTransform(east_pac_spdf, CRS(newCRS_east))
east_pac_spdf_shift <- gBuffer(east_pac_spdf_shift, byid=TRUE, width=0) #gets rid of buffers, allows for union
#rotate raster for bathymetry (guided by extent of etoposhelf raster,  that's why wacky #s)
x1 <- crop(etopo_shelf_raster, extent(-180.0167, -0.0167, -90.01667, 90.01667))
x2 <- crop(etopo_shelf_raster, extent(0, 180.0167, -90.01667, 90.01667))   
extent(x1) <- c(180.0167, 360.0167, -90.01667 , 90.01667)
etopo_shelf_raster_180 <- merge(x1, x2)

#get rid of buffer for east atl as well

east_atl_spdf_nobuf <- gBuffer(east_atl_spdf, byid=TRUE, width=0)

region_names <- c("west_pac_spdf_shift", "east_pac_spdf_shift", "west_atl_spdf", "west_ind_spdf", "east_atl_spdf_nobuf", "east_ind_spdf")



#dissolve all polygons by region
for (i in 1:length(region_names)) {
  name <- paste0(region_names[i], "_agg")
  assign(name, gUnaryUnion(get(region_names[i]))) #dissolve polygons into one
}

```


Extract bathymetry data from polygon only to make sure we're limiting to shelf regions above 2000 meters

```{r polygon to raster}

region_names_shift <- region_names[1:2]


region_names_noshift <- region_names[3:6]


for (i in 1:length(region_names_noshift)) {
#crop bathymetry layer to LME subset
  raster_extent <-
       crop(etopo_shelf_raster, extent(get(paste0(region_names_noshift[i], "_agg"))))

#which areas of raster fall within borders?
  assign(paste0(region_names_noshift[i], "_mask"),
       mask(raster_extent, get(paste0(region_names_noshift[i], "_agg"))))

}

#edit for east_pac_spdf_shift and west_pac_spdf_shift
for (i in 1:length(region_names_shift[1:2])) {
#crop bathy layer to LME subset
  raster_extent <-
       crop(etopo_shelf_raster_180, extent(get(paste0(region_names_shift[i], "_agg"))))

#which areas of raster fall within borders?
  assign(paste0(region_names_shift[i], "_mask"),
       mask(raster_extent, get(paste0(region_names_shift[i], "_agg"))))

}

```

Splitting raster into many to plot individually

Western Pacific
```{r split raster for western pacific}
north_extent <- c(xmin(west_pac_spdf_shift_mask), xmax(west_pac_spdf_shift_mask), 0, ymax(west_pac_spdf_shift_mask))
south_extent <- c(xmin(west_pac_spdf_shift_mask), xmax(west_pac_spdf_shift_mask), ymin(west_pac_spdf_shift_mask), 0)

#crop into above and below 0
west_pac_spdf_shift_agg_north <- crop(west_pac_spdf_shift_mask, extent(north_extent))
west_pac_spdf_shift_agg_south <- crop(west_pac_spdf_shift_mask, extent(south_extent))

#unfortunately, I think I may have to just do this manually (ugly, I know)

#all chunks for west pacific
west_pac_north_latitudes <- seq(0, ymax(west_pac_spdf_shift_mask), by = 0.5)
west_pac_south_latitudes <- seq(-0.5, ymin(west_pac_spdf_shift_mask), by = -0.5)

west_pac_shelf_areas <- as.data.table(matrix(nrow = (length(west_pac_north_latitudes)-1+length(west_pac_south_latitudes)-1)))
                                      
west_pac_shelf_areas[, latitude_start := as.numeric(V1)][, latitude_end := as.numeric(V1)][, area := as.numeric(V1)][, V1 := NULL]

#loop for north
for (i in 1:(length(west_pac_north_latitudes)-1)) {
  north_extent <- c(xmin(west_pac_spdf_shift_mask), xmax(west_pac_spdf_shift_mask), west_pac_north_latitudes[i], west_pac_north_latitudes[i+1])
  segment <- crop(west_pac_spdf_shift_mask, extent(north_extent))
  
  if(all(is.na(values(segment)))) {
    
  west_pac_shelf_areas[i, "latitude_start"] <- west_pac_north_latitudes[i]
  west_pac_shelf_areas[i, "latitude_end"] <- west_pac_north_latitudes[i+1]
  west_pac_shelf_areas[i, "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  west_pac_shelf_areas[i, "latitude_start"] <- west_pac_north_latitudes[i]
  west_pac_shelf_areas[i, "latitude_end"] <- west_pac_north_latitudes[i+1]
  west_pac_shelf_areas[i, "area"] <- segment_area
  
  print(i)
  } 
}

#loop for south
for (i in 1:(length(west_pac_south_latitudes)-1)) {
  south_extent <- c(xmin(west_pac_spdf_shift_mask), xmax(west_pac_spdf_shift_mask), west_pac_south_latitudes[i+1], west_pac_south_latitudes[i])
  segment <- crop(west_pac_spdf_shift_mask, extent(south_extent))
  
  if(all(is.na(values(segment)))) {
    
  west_pac_shelf_areas[i+(length(west_pac_north_latitudes)-1), "latitude_start"] <- west_pac_south_latitudes[i]
  west_pac_shelf_areas[i+(length(west_pac_north_latitudes)-1), "latitude_end"] <- west_pac_south_latitudes[i+1]
  west_pac_shelf_areas[i+(length(west_pac_north_latitudes)-1), "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  west_pac_shelf_areas[i+(length(west_pac_north_latitudes)-1), "latitude_start"] <- west_pac_south_latitudes[i]
  west_pac_shelf_areas[i+(length(west_pac_north_latitudes)-1), "latitude_end"] <- west_pac_south_latitudes[i+1]
  west_pac_shelf_areas[i+(length(west_pac_north_latitudes)-1), "area"] <- segment_area
  
  print(i)
  } 
}

```

Eastern Pacific

east_pac_spdf_shift

```{r split raster for eastern pacific}
north_extent <- c(xmin(east_pac_spdf_shift_mask), xmax(east_pac_spdf_shift_mask), 0, ymax(east_pac_spdf_shift_mask))
south_extent <- c(xmin(east_pac_spdf_shift_mask), xmax(east_pac_spdf_shift_mask), ymin(east_pac_spdf_shift_mask), 0)

#crop into above and below 0
east_pac_spdf_shift_agg_north <- crop(east_pac_spdf_shift_mask, extent(north_extent))
east_pac_spdf_shift_agg_south <- crop(east_pac_spdf_shift_mask, extent(south_extent))

#unfortunately, I think I may have to just do this manually (ugly, I know)

#all chunks for east pacific
east_pac_north_latitudes <- seq(0, ymax(east_pac_spdf_shift_mask), by = 0.5)
east_pac_south_latitudes <- seq(-0.5, ymin(east_pac_spdf_shift_mask), by = -0.5)

east_pac_shelf_areas <- as.data.table(matrix(nrow = (length(east_pac_north_latitudes)-1+length(east_pac_south_latitudes)-1)))
                                      
east_pac_shelf_areas[, latitude_start := as.numeric(V1)][, latitude_end := as.numeric(V1)][, area := as.numeric(V1)][, V1 := NULL]

#loop for north
for (i in 1:(length(east_pac_north_latitudes)-1)) {
  north_extent <- c(xmin(east_pac_spdf_shift_mask), xmax(east_pac_spdf_shift_mask), east_pac_north_latitudes[i], east_pac_north_latitudes[i+1])
  segment <- crop(east_pac_spdf_shift_mask, extent(north_extent))
  
  if(all(is.na(values(segment)))) {
    
  east_pac_shelf_areas[i, "latitude_start"] <- east_pac_north_latitudes[i]
  east_pac_shelf_areas[i, "latitude_end"] <- east_pac_north_latitudes[i+1]
  east_pac_shelf_areas[i, "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  east_pac_shelf_areas[i, "latitude_start"] <- east_pac_north_latitudes[i]
  east_pac_shelf_areas[i, "latitude_end"] <- east_pac_north_latitudes[i+1]
  east_pac_shelf_areas[i, "area"] <- segment_area
  
  print(i)
  } 
}

#loop for south
for (i in 1:(length(east_pac_south_latitudes)-1)) {
  south_extent <- c(xmin(east_pac_spdf_shift_mask), xmax(east_pac_spdf_shift_mask), east_pac_south_latitudes[i+1], east_pac_south_latitudes[i])
  segment <- crop(east_pac_spdf_shift_mask, extent(south_extent))
  
  if(all(is.na(values(segment)))) {
    
  east_pac_shelf_areas[i+(length(east_pac_north_latitudes)-1), "latitude_start"] <- east_pac_south_latitudes[i]
  east_pac_shelf_areas[i+(length(east_pac_north_latitudes)-1), "latitude_end"] <- east_pac_south_latitudes[i+1]
  east_pac_shelf_areas[i+(length(east_pac_north_latitudes)-1), "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  east_pac_shelf_areas[i+(length(east_pac_north_latitudes)-1), "latitude_start"] <- east_pac_south_latitudes[i]
  east_pac_shelf_areas[i+(length(east_pac_north_latitudes)-1), "latitude_end"] <- east_pac_south_latitudes[i+1]
  east_pac_shelf_areas[i+(length(east_pac_north_latitudes)-1), "area"] <- segment_area
  
  print(i)
  } 
}

```

Western Atlantic

west_atl_spdf_mask

```{r split raster for western atlantic}
north_extent <- c(xmin(west_atl_spdf), xmax(west_atl_spdf_mask), 0, ymax(west_atl_spdf_mask))
                  
south_extent <- c(xmin(west_atl_spdf_mask), xmax(west_atl_spdf_mask), ymin(west_atl_spdf_mask), 0)

#crop into above and below 0
west_atl_agg_north <- crop(west_atl_spdf_mask, extent(north_extent))
west_atl_agg_south <- crop(west_atl_spdf_mask, extent(south_extent))

#unfortunately, I think I may have to just do this manually (ugly, I know)

#all chunks for east pacific
west_atl_north_latitudes <- seq(0, ymax(west_atl_spdf_mask), by = 0.5)
west_atl_south_latitudes <- seq(-0.5, ymin(west_atl_spdf_mask), by = -0.5)

west_atl_shelf_areas <- as.data.table(matrix(nrow = (length(west_atl_north_latitudes)-1+length(west_atl_south_latitudes)-1)))
                                      
west_atl_shelf_areas[, latitude_start := as.numeric(V1)][, latitude_end := as.numeric(V1)][, area := as.numeric(V1)][, V1 := NULL]

#loop for north
for (i in 1:(length(west_atl_north_latitudes)-1)) {
  north_extent <- c(xmin(west_atl_spdf_mask), xmax(west_atl_spdf_mask), west_atl_north_latitudes[i], west_atl_north_latitudes[i+1])
  segment <- crop(west_atl_spdf_mask, extent(north_extent))
  
  if(all(is.na(values(segment)))) {
    
  west_atl_shelf_areas[i, "latitude_start"] <- west_atl_north_latitudes[i]
  west_atl_shelf_areas[i, "latitude_end"] <- west_atl_north_latitudes[i+1]
  west_atl_shelf_areas[i, "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  west_atl_shelf_areas[i, "latitude_start"] <- west_atl_north_latitudes[i]
  west_atl_shelf_areas[i, "latitude_end"] <- west_atl_north_latitudes[i+1]
  west_atl_shelf_areas[i, "area"] <- segment_area
  
  print(i)
  } 
}

#loop for south
for (i in 1:(length(west_atl_south_latitudes)-1)) {
  south_extent <- c(xmin(west_atl_spdf_mask), xmax(west_atl_spdf_mask), west_atl_south_latitudes[i+1], west_atl_south_latitudes[i])
  segment <- crop(west_atl_spdf_mask, extent(south_extent))
  
  if(all(is.na(values(segment)))) {
    
  west_atl_shelf_areas[i+(length(west_atl_north_latitudes)-1), "latitude_start"] <- west_atl_south_latitudes[i]
  west_atl_shelf_areas[i+(length(west_atl_north_latitudes)-1), "latitude_end"] <- west_atl_south_latitudes[i+1]
  west_atl_shelf_areas[i+(length(west_atl_north_latitudes)-1), "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  west_atl_shelf_areas[i+(length(west_atl_north_latitudes)-1), "latitude_start"] <- west_atl_south_latitudes[i]
  west_atl_shelf_areas[i+(length(west_atl_north_latitudes)-1), "latitude_end"] <- west_atl_south_latitudes[i+1]
  west_atl_shelf_areas[i+(length(west_atl_north_latitudes)-1), "area"] <- segment_area
  
  print(i)
  } 
}

```

Eastern Atlantic

east_atl_spdf_nobuf_mask

```{r split raster for eastern atlantic}
north_extent <- c(xmin(east_atl_spdf_nobuf_mask), xmax(east_atl_spdf_nobuf_mask), 0, ymax(east_atl_spdf_nobuf_mask))
south_extent <- c(xmin(east_atl_spdf_nobuf_mask), xmax(east_atl_spdf_nobuf_mask), ymin(east_atl_spdf_nobuf_mask), 0)

#crop into above and below 0
east_atl_agg_north <- crop(east_atl_spdf_nobuf_mask, extent(north_extent))
east_atl_agg_south <- crop(east_atl_spdf_nobuf_mask, extent(south_extent))

#unfortunately, I think I may have to just do this manually (ugly, I know)

#all chunks for east pacific
east_atl_north_latitudes <- seq(0, ymax(east_atl_spdf_nobuf_mask), by = 0.5)
east_atl_south_latitudes <- seq(-0.5, ymin(east_atl_spdf_nobuf_mask), by = -0.5)

east_atl_shelf_areas <- as.data.table(matrix(nrow = (length(east_atl_north_latitudes)-1+length(east_atl_south_latitudes)-1)))
                                      
east_atl_shelf_areas[, latitude_start := as.numeric(V1)][, latitude_end := as.numeric(V1)][, area := as.numeric(V1)][, V1 := NULL]

#loop for north
for (i in 1:(length(east_atl_north_latitudes)-1)) {
  north_extent <- c(xmin(east_atl_spdf_nobuf_mask), xmax(east_atl_spdf_nobuf_mask), east_atl_north_latitudes[i], east_atl_north_latitudes[i+1])
  segment <- crop(east_atl_spdf_nobuf_mask, extent(north_extent))
  
  if(all(is.na(values(segment)))) {
    
  east_atl_shelf_areas[i, "latitude_start"] <- east_atl_north_latitudes[i]
  east_atl_shelf_areas[i, "latitude_end"] <- east_atl_north_latitudes[i+1]
  east_atl_shelf_areas[i, "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  east_atl_shelf_areas[i, "latitude_start"] <- east_atl_north_latitudes[i]
  east_atl_shelf_areas[i, "latitude_end"] <- east_atl_north_latitudes[i+1]
  east_atl_shelf_areas[i, "area"] <- segment_area
  
  print(i)
  } 
}

#loop for south
for (i in 1:(length(east_atl_south_latitudes)-1)) {
  south_extent <- c(xmin(east_atl_spdf_nobuf_mask), xmax(east_atl_spdf_nobuf_mask), east_atl_south_latitudes[i+1], east_atl_south_latitudes[i])
  segment <- crop(east_atl_spdf_nobuf_mask, extent(south_extent))
  
  if(all(is.na(values(segment)))) {
    
  east_atl_shelf_areas[i+(length(east_atl_north_latitudes)-1), "latitude_start"] <- east_atl_south_latitudes[i]
  east_atl_shelf_areas[i+(length(east_atl_north_latitudes)-1), "latitude_end"] <- east_atl_south_latitudes[i+1]
  east_atl_shelf_areas[i+(length(east_atl_north_latitudes)-1), "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  east_atl_shelf_areas[i+(length(east_atl_north_latitudes)-1), "latitude_start"] <- east_atl_south_latitudes[i]
  east_atl_shelf_areas[i+(length(east_atl_north_latitudes)-1), "latitude_end"] <- east_atl_south_latitudes[i+1]
  east_atl_shelf_areas[i+(length(east_atl_north_latitudes)-1), "area"] <- segment_area
  
  print(i)
  } 
}

```

Western Indian

west_ind_spdf_mask

```{r split raster for western indian}
north_extent <- c(xmin(west_ind_spdf_mask), xmax(west_ind_spdf_mask), 0, ymax(west_ind_spdf_mask))
south_extent <- c(xmin(west_ind_spdf_mask), xmax(west_ind_spdf_mask), ymin(west_ind_spdf_mask), 0)

#crop into above and below 0
west_ind_agg_north <- crop(west_ind_spdf_mask, extent(north_extent))
west_ind_agg_south <- crop(west_ind_spdf_mask, extent(south_extent))

#unfortunately, I think I may have to just do this manually (ugly, I know)

#all chunks for east pacific
west_ind_north_latitudes <- seq(0, ymax(west_ind_spdf_mask), by = 0.5)
west_ind_south_latitudes <- seq(-0.5, ymin(west_ind_spdf_mask), by = -0.5)

west_ind_shelf_areas <- as.data.table(matrix(nrow = (length(west_ind_north_latitudes)-1+length(west_ind_south_latitudes)-1)))
                                      
west_ind_shelf_areas[, latitude_start := as.numeric(V1)][, latitude_end := as.numeric(V1)][, area := as.numeric(V1)][, V1 := NULL]

#loop for north
for (i in 1:(length(west_ind_north_latitudes)-1)) {
  north_extent <- c(xmin(west_ind_spdf_mask), xmax(west_ind_spdf_mask), west_ind_north_latitudes[i], west_ind_north_latitudes[i+1])
  segment <- crop(west_ind_spdf_mask, extent(north_extent))
  
  if(all(is.na(values(segment)))) {
    
  west_ind_shelf_areas[i, "latitude_start"] <- west_ind_north_latitudes[i]
  west_ind_shelf_areas[i, "latitude_end"] <- west_ind_north_latitudes[i+1]
  west_ind_shelf_areas[i, "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  west_ind_shelf_areas[i, "latitude_start"] <- west_ind_north_latitudes[i]
  west_ind_shelf_areas[i, "latitude_end"] <- west_ind_north_latitudes[i+1]
  west_ind_shelf_areas[i, "area"] <- segment_area
  
  print(i)
  } 
}

#loop for south
for (i in 1:(length(west_ind_south_latitudes)-1)) {
  south_extent <- c(xmin(west_ind_spdf_mask), xmax(west_ind_spdf_mask), west_ind_south_latitudes[i+1], west_ind_south_latitudes[i])
  segment <- crop(west_ind_spdf_mask, extent(south_extent))
  
  if(all(is.na(values(segment)))) {
    
  west_ind_shelf_areas[i+(length(west_ind_north_latitudes)-1), "latitude_start"] <- west_ind_south_latitudes[i]
  west_ind_shelf_areas[i+(length(west_ind_north_latitudes)-1), "latitude_end"] <- west_ind_south_latitudes[i+1]
  west_ind_shelf_areas[i+(length(west_ind_north_latitudes)-1), "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  west_ind_shelf_areas[i+(length(west_ind_north_latitudes)-1), "latitude_start"] <- west_ind_south_latitudes[i]
  west_ind_shelf_areas[i+(length(west_ind_north_latitudes)-1), "latitude_end"] <- west_ind_south_latitudes[i+1]
  west_ind_shelf_areas[i+(length(west_ind_north_latitudes)-1), "area"] <- segment_area
  
  print(i)
  } 
}

```


Eastern Indian

east_ind_spdf_mask

```{r split raster for eastern indian}
north_extent <- c(xmin(east_ind_spdf_mask), xmax(east_ind_spdf_mask), 0, ymax(east_ind_spdf_mask))
south_extent <- c(xmin(east_ind_spdf_mask), xmax(east_ind_spdf_mask), ymin(east_ind_spdf_mask), 0)

#crop into above and below 0
east_ind_agg_north <- crop(east_ind_spdf_mask, extent(north_extent))
east_ind_agg_south <- crop(east_ind_spdf_mask, extent(south_extent))

#unfortunately, I think I may have to just do this manually (ugly, I know)

#all chunks for east pacific
east_ind_north_latitudes <- seq(0, ymax(east_ind_spdf_mask), by = 0.5)
east_ind_south_latitudes <- seq(-0.5, ymin(east_ind_spdf_mask), by = -0.5)

east_ind_shelf_areas <- as.data.table(matrix(nrow = (length(east_ind_north_latitudes)-1+length(east_ind_south_latitudes)-1)))
                                      
east_ind_shelf_areas[, latitude_start := as.numeric(V1)][, latitude_end := as.numeric(V1)][, area := as.numeric(V1)][, V1 := NULL]

#loop for north
for (i in 1:(length(east_ind_north_latitudes)-1)) {
  north_extent <- c(xmin(east_ind_spdf_mask), xmax(east_ind_spdf_mask), east_ind_north_latitudes[i], east_ind_north_latitudes[i+1])
  segment <- crop(east_ind_spdf_mask, extent(north_extent))
  
  if(all(is.na(values(segment)))) {
    
  east_ind_shelf_areas[i, "latitude_start"] <- east_ind_north_latitudes[i]
  east_ind_shelf_areas[i, "latitude_end"] <- east_ind_north_latitudes[i+1]
  east_ind_shelf_areas[i, "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  east_ind_shelf_areas[i, "latitude_start"] <- east_ind_north_latitudes[i]
  east_ind_shelf_areas[i, "latitude_end"] <- east_ind_north_latitudes[i+1]
  east_ind_shelf_areas[i, "area"] <- segment_area
  
  print(i)
  } 
}

#loop for south
for (i in 1:(length(east_ind_south_latitudes)-1)) {
  south_extent <- c(xmin(east_ind_spdf_mask), xmax(east_ind_spdf_mask), east_ind_south_latitudes[i+1], east_ind_south_latitudes[i])
  segment <- crop(east_ind_spdf_mask, extent(south_extent))
  
  if(all(is.na(values(segment)))) {
    
  east_ind_shelf_areas[i+(length(east_ind_north_latitudes)-1), "latitude_start"] <- east_ind_south_latitudes[i]
  east_ind_shelf_areas[i+(length(east_ind_north_latitudes)-1), "latitude_end"] <- east_ind_south_latitudes[i+1]
  east_ind_shelf_areas[i+(length(east_ind_north_latitudes)-1), "area"] <- 0
  
  print(i)
    
  } else {
  #get sizes of all cells in raster [km2]
    cell_size<-area(segment, na.rm=TRUE, weights=FALSE)
    #delete NAs from vector of all raster cells
    ##NAs lie outside of the rastered region, can thus be omitted
    cell_size<-cell_size[!is.na(segment)]
    #compute area [km2] of all cells in geo_raster
    segment_area <-length(cell_size)*median(cell_size)

  east_ind_shelf_areas[i+(length(east_ind_north_latitudes)-1), "latitude_start"] <- east_ind_south_latitudes[i]
  east_ind_shelf_areas[i+(length(east_ind_north_latitudes)-1), "latitude_end"] <- east_ind_south_latitudes[i+1]
  east_ind_shelf_areas[i+(length(east_ind_north_latitudes)-1), "area"] <- segment_area
  
  print(i)
  } 
}

save(east_ind_shelf_areas, west_ind_shelf_areas, east_atl_shelf_areas, west_atl_shelf_areas, east_pac_shelf_areas, west_pac_shelf_areas ,file = "shelf_areas_by_0.5latitude.RData")

```

Plots of latitude versus habitat availability

```{r plots}
area_latitude_east_ind <- ggplot(east_ind_shelf_areas, aes(latitude_start, area)) +
  geom_point(shape =18) + 
  geom_line() +
  labs(x = "Latitude", y = "Area (km^2)") +
  annotate("text", x =25, y = 100000, label = "Eastern Indian Ocean") +
  geom_vline(xintercept = 0) +
  
  coord_flip() +
  theme_classic()

  ggsave(area_latitude_east_ind, filename = "area_latitude_east_ind.jpg")

area_latitude_west_ind  <- ggplot(west_ind_shelf_areas, aes(latitude_start, area)) +
  geom_point(shape = 18) + 
  geom_line() +
  labs(x = "Latitude", y = "Area (km^2)") +
  annotate("text", x = 35, y = 45000, label = "Western Indian Ocean") +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic()

  ggsave(area_latitude_west_ind, filename = "area_latitude_west_ind.jpg")

area_latitude_west_atl  <- ggplot(west_atl_shelf_areas, aes(latitude_start, area)) +
  geom_point(shape =18) + 
  geom_line() +
  labs(x = "Latitude", y = "Area (km^2)") +
  annotate("text", x = 90, y = 170000, label = "Western Atlantic Ocean") +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic()

  ggsave(area_latitude_west_atl, filename = "area_latitude_west_atl.jpg")

area_latitude_east_atl  <- ggplot(east_atl_shelf_areas, aes(latitude_start, area)) +
  geom_point(shape =18) + 
  geom_line() +
  labs(x = "Latitude", y = "Area (km^2)") +
  annotate("text", x = 90, y = 150000, label = "Eastern Atlantic Ocean") +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic()

  ggsave(area_latitude_east_atl, filename = "area_latitude_east_atl.jpg")

area_latitude_east_pac  <- ggplot(east_pac_shelf_areas, aes(latitude_start, area)) +
  geom_point(shape =18) + 
  geom_line() +
  labs(x = "Latitude", y = "Area (km^2)") +
  annotate("text", x = 90, y = 170000, label = "Eastern Pacific Ocean") +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic()

  ggsave(area_latitude_east_pac, filename = "area_latitude_east_pac.jpg")

area_latitude_west_pac <- ggplot(west_pac_shelf_areas, aes(latitude_start, area)) +
  geom_point(shape =18) + 
  geom_line() +
  labs(x = "Latitude", y = "Area (km^2)") +
  annotate("text", x = 90, y = 170000, label = "Western Pacific Ocean") +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic()

  ggsave(area_latitude_west_pac, filename = "area_latitude_west_pac.jpg")

```

Now, I should make maps for each of these regions

```{r map regions}
library(ggspatial)
install.packages("sf")

  world <- ne_countries(scale = "medium", returnclass = "sf")
  #shift world file for some regions
world_shift <- st_shift_longitude(world)

region_maps <- list()

for (i in 1:length(region_names)) {
  
  region_spdf <- get(region_names[i])
  
  region_spdf_ext <- extent(region_spdf)
  
  #convert to plottable data frame
  region_spdf@data$id <- rownames(region_spdf@data)
  region_spdf.points <- fortify(region_spdf, region="id")
  region_spdf.df <- merge(region_spdf.points, region_spdf@data, by="id")
  
  
  region_maps[[i]] <- ggplot() +
      geom_sf(data = world) +
  #    annotation_scale(location = "bl", width_hint = 0.5) + #too big of space for scale
  #    annotation_north_arrow(location = "bl", which_north = "true", 
  #        pad_x = unit(0.75, "in"), pad_y = unit(0.5, "in"),
  #        style = north_arrow_fancy_orienteering) +
   # xlim(c(0, 359.9953)) +
    geom_polygon(data = region_spdf.df, aes(x=long, y = lat, group = group), lwd = 0, fill = "darksalmon") +
      coord_sf(xlim = c(region_spdf_ext[1], region_spdf_ext[2]), ylim = c(region_spdf_ext[3], region_spdf_ext[4])) +
    geom_abline(intercept = 0, slope = 0) +
    labs( x = "Longitude", y = "Latitude") +
    theme_classic()
  
  filename <- paste0(region_names[i], "_map.jpg")
  ggsave(plot = region_maps[[i]], filename = filename)

}
```

