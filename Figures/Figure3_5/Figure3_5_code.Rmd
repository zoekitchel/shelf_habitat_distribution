---
title: "Updated Figures 3_4_5: map,area,richness"
output: html_notebook
---

Map, area, richness

```{r setup}
library(data.table)
library(ggplot2)
library(cowplot)
library(egg)
library(mapproj)

west_pac_shelf_areas <- readRDS(here::here("output","2_degree_latitude","west_pac_shelf_areas_2degrees.rds"))
west_atl_shelf_areas <- readRDS(here::here("output","2_degree_latitude","west_atl_shelf_areas_2degrees.rds"))
west_ind_shelf_areas <- readRDS(here::here("output","2_degree_latitude","west_ind_shelf_areas_2degrees.rds"))
east_pac_shelf_areas <- readRDS(here::here("output","2_degree_latitude","east_pac_shelf_areas_2degrees.rds"))
east_atl_shelf_areas <- readRDS(here::here("output","2_degree_latitude","east_atl_shelf_areas_2degrees.rds"))
east_ind_shelf_areas <- readRDS(here::here("output","2_degree_latitude","east_ind_shelf_areas_2degrees.rds"))

load(here::here("Figures", "Figure3_5","latitude_area_plots.RData")) #CHECK FOR INDIAN

load(here::here("Figures","Figure3_5", "region_maps.RData")) #maps

load(here::here("Figures","Figure3_5", "latitude_2degree_maps.RData")) #latitude area plots

shelf_areas <- readRDS(file = here::here("output","2_degree_latitude","shelf_areas.rds")) #spp richness stats
```


#East Atlantic
```{r east atlantic plots}
(east_atlantic_spprichness <- ggplot(data = shelf_areas[region == "East Atlantic"], aes(x=latitude_start, y=change_spp_predicted_levin)) +
   geom_col(aes(fill=spp_change_pos_neg_levin), alpha = 0.5) +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression(Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

#with 3 levels and error bars
(east_atlantic_spprichness_errorbars <- ggplot(data = shelf_areas[region == "East Atlantic"], aes(x=latitude_start, y=log_abs_change_spp_predicted_38*spp_change_pos_neg_38)) +
   geom_col(aes(fill=spp_change_pos_neg_38_discrete), alpha = 0.5) +
  geom_errorbar(aes(ymin=log_abs_change_spp_predicted_175*spp_change_pos_neg_175, ymax=log_abs_change_spp_predicted_62*spp_change_pos_neg_62), size = 0.2, alpha = 0.6)  +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression('log'~Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

```

#West Atlantic

```{r west atlantic plots}
(west_atlantic_spprichness <- ggplot(data = shelf_areas[region == "West Atlantic"], aes(x=latitude_start, y=change_spp_predicted_levin)) +
   geom_col(aes(fill=spp_change_pos_neg_levin), alpha = 0.5) +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y =expression(Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

direction_spp_richness_change_legend <- get_legend(west_atlantic_spprichness)

#with 3 levels and error bars
(west_atlantic_spprichness_errorbars <- ggplot(data = shelf_areas[region == "West Atlantic"], aes(x=latitude_start, y=log_abs_change_spp_predicted_38*spp_change_pos_neg_38)) +
   geom_col(aes(fill=spp_change_pos_neg_38_discrete), alpha = 0.5) +
  geom_errorbar(aes(ymin=log_abs_change_spp_predicted_175*spp_change_pos_neg_175, ymax=log_abs_change_spp_predicted_62*spp_change_pos_neg_62), size = 0.2, alpha = 0.6)  +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression('log'~Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

```

#Atlantic merge
```{r atlantic merge}
figure_4_atlantic_full <- egg::ggarrange(region_maps[[3]] + 
                                                theme(legend.position = "top",
                                                      axis.title.x = element_blank(),
                                                      plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
 coord_equal(ylim = c(-55,85), xlim = c(-180,0)) +
                                                scale_y_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
          area_latitude_west_atl + 
               theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                     legend.position = "top",
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
      guides(color = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
            xlim(x=c(min(west_atl_shelf_areas$latitude_start),max(west_atl_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
          west_atlantic_spprichness +
                           theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "top") +
      guides(fill = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
   xlim(x=c(min(west_atl_shelf_areas$latitude_start),max(west_atl_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
 region_maps[[5]] + theme(legend.position = "none",
                                                                          plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_y_continuous(breaks = c(-40,-20,0,20,40,60,80)) +  coord_equal(ylim = c(-35,81), xlim = c(-20,180)),
          area_latitude_east_atl + 
               theme(axis.text.y = element_blank(),
           #          axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     legend.position = "none",
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)),
          east_atlantic_spprichness +
            theme(axis.text.y = element_blank(),
            #    axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "none") +
                                                 scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)),
 nrow = 2, top = T, bottom = T, widths = c(1,0.7,0.7,1.7,1,1))


figure_4_atlantic_full

ggsave(figure_4_atlantic_full, path = here::here("Figures", "Figure3_5"), filename = "Figure4_atlantic_latitude_area_spprichness.pdf", height = 6, width = 10, unit = "in")
ggsave(figure_4_atlantic_full, path = here::here("Figures", "Figure3_5"), filename = "Figure4_atlantic_latitude_area_spprichness.jpg", height = 6, width = 10, unit = "in")
```

#Atlantic merge three levels
```{r atlantic merge  three levels}
figure_4_atlantic_full_threelevels <- egg::ggarrange(region_maps[[3]] + 
                                                theme(legend.position = "top",
                                                      axis.title.x = element_blank(),
                                                      plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
 coord_equal(ylim = c(-55,85), xlim = c(-180,0)) +
                                                scale_y_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
          area_latitude_west_atl + 
               theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                     legend.position = "top",
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
      guides(color = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
            xlim(x=c(min(west_atl_shelf_areas$latitude_start),max(west_atl_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
          west_atlantic_spprichness_errorbars +
                           theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "top") +
      guides(fill = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
   xlim(x=c(min(west_atl_shelf_areas$latitude_start),max(west_atl_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
 region_maps[[5]] + theme(legend.position = "none",
                                                                          plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_y_continuous(breaks = c(-40,-20,0,20,40,60,80)) +  coord_equal(ylim = c(-35,81), xlim = c(-20,180)),
          area_latitude_east_atl + 
               theme(axis.text.y = element_blank(),
           #          axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     legend.position = "none",
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)),
          east_atlantic_spprichness_errorbars +
            theme(axis.text.y = element_blank(),
            #    axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "none") +
                                                 scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)),
 nrow = 2, top = T, bottom = T, widths = c(1,0.7,0.7,1.7,1,1))


figure_4_atlantic_full_threelevels

ggsave(figure_4_atlantic_full_threelevels, path = here::here("Figures", "Figure3_5"), filename = "Figure4_atlantic_latitude_area_spprichness_threelevels.pdf", height = 6, width = 10, unit = "in")
ggsave(figure_4_atlantic_full_threelevels, path = here::here("Figures", "Figure3_5"), filename = "Figure4_atlantic_latitude_area_spprichness_threelevels.jpg", height = 6, width = 10, unit = "in")
```

#East pacific
```{r east pacific plots}
(east_pacific_spprichness <- ggplot(data = shelf_areas[region == "East Pacific"], aes(x=latitude_start, y=change_spp_predicted_levin)) +
   geom_col(aes(fill=spp_change_pos_neg_levin), alpha = 0.5) +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression(Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  xlim(x=c(min(shelf_areas[region == "East Pacific"]$latitude_start),max(shelf_areas[region == "East Pacific"]$latitude_start))) +
scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)) +
  coord_flip() +
  theme_classic())

#with 3 levels and error bars
(east_pacific_spprichness_errorbars <- ggplot(data = shelf_areas[region == "East Pacific"], aes(x=latitude_start, y=log_abs_change_spp_predicted_38*spp_change_pos_neg_38)) +
   geom_col(aes(fill=spp_change_pos_neg_38_discrete), alpha = 0.5) +
  geom_errorbar(aes(ymin=log_abs_change_spp_predicted_175*spp_change_pos_neg_175, ymax=log_abs_change_spp_predicted_62*spp_change_pos_neg_62), size = 0.2, alpha = 0.6)  +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression('log'~Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

```

#West pacific

```{r west pacific plots}
(west_pacific_spprichness <- ggplot(data = shelf_areas[region == "West Pacific"], aes(x=latitude_start, y=change_spp_predicted_levin)) +
   geom_col(aes(fill=spp_change_pos_neg_levin), alpha = 0.5) +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression(Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  xlim(x=c(min(shelf_areas[region == "West Pacific"]$latitude_start),max(shelf_areas[region == "West Pacific"]$latitude_start))) +
                                                 scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)) +
  coord_flip() +
  theme_classic())

#with 3 levels and error bars
(west_pacific_spprichness_errorbars <- ggplot(data = shelf_areas[region == "West Pacific"], aes(x=latitude_start, y=log_abs_change_spp_predicted_38*spp_change_pos_neg_38)) +
   geom_col(aes(fill=spp_change_pos_neg_38_discrete), alpha = 0.5) +
  geom_errorbar(aes(ymin=log_abs_change_spp_predicted_175*spp_change_pos_neg_175, ymax=log_abs_change_spp_predicted_62*spp_change_pos_neg_62), size = 0.2, alpha = 0.6)  +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression('log'~Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

```

#pacific merge
```{r pacific merge}
figure_3_pacific_full <- egg::ggarrange(region_maps[[1]] + ylim(c(min(west_pac_shelf_areas$latitude_end),max(west_pac_shelf_areas$latitude_end))) +
                                                theme(legend.position = "top",
                                                      legend.title = element_blank(),
                                                      axis.title.x = element_blank(),
                                                      plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                          scale_y_continuous(breaks = c(-40,-20,0,20,40,60,80)) +
coord_equal(ylim = c(-43, 78), xlim = c(0,210)),
          area_latitude_west_pac + 
               theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                     legend.position = "top",
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
      guides(color = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
            xlim(x=c(min(west_pac_shelf_areas$latitude_start),max(west_pac_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)),
          west_pacific_spprichness +
                           theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "top") +
      guides(fill = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
   xlim(x=c(min(west_pac_shelf_areas$latitude_start),max(west_pac_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
 region_maps[[2]] + theme(legend.position = "none", plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_y_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)) + coord_equal(ylim = c(-54, 77), xlim = c(160,300)),
          area_latitude_east_pac + 
               theme(axis.text.y = element_blank(),
           #          axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     legend.position = "none",
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
          east_pacific_spprichness +
            theme(axis.text.y = element_blank(),
            #    axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "none") +
                                                 scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
 nrow = 2, top = T, bottom = T, widths = c(1,0.7,0.7,1.7,1,1))


figure_3_pacific_full

ggsave(figure_3_pacific_full, path = here::here("Figures", "Figure3_5"), filename = "Figure3_pacific_latitude_area_spprichness.pdf", height = 6, width = 10, unit = "in")
ggsave(figure_3_pacific_full, path = here::here("Figures", "Figure3_5"), filename = "Figure3_pacific_latitude_area_spprichness.jpg", height = 6, width = 10, unit = "in")




```
#Pacific merge 3 levels

```{r pacific merge three levels}
figure_3_pacific_full_threelevels <- egg::ggarrange(region_maps[[1]] + ylim(c(min(west_pac_shelf_areas$latitude_end),max(west_pac_shelf_areas$latitude_end))) +
                                                theme(legend.position = "top",
                                                      legend.title = element_blank(),
                                                      axis.title.x = element_blank(),
                                                      plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                          scale_y_continuous(breaks = c(-40,-20,0,20,40,60,80)) +
coord_equal(ylim = c(-43, 78), xlim = c(0,210)),
          area_latitude_west_pac + 
               theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                     legend.position = "top",
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
      guides(color = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
            xlim(x=c(min(west_pac_shelf_areas$latitude_start),max(west_pac_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-40,-20,0,20,40,60,80)),
          east_pacific_spprichness_errorbars +
                           theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "top") +
      guides(fill = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
   xlim(x=c(min(west_pac_shelf_areas$latitude_start),max(west_pac_shelf_areas$latitude_start))) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
 region_maps[[2]] + theme(legend.position = "none", plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_y_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)) + coord_equal(ylim = c(-54, 77), xlim = c(160,300)),
          area_latitude_east_pac + 
               theme(axis.text.y = element_blank(),
           #          axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     legend.position = "none",
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
          east_pacific_spprichness_errorbars +
            theme(axis.text.y = element_blank(),
            #    axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "none") +
                                                 scale_x_continuous(breaks = c(-60,-40,-20,0,20,40,60,80)),
 nrow = 2, top = T, bottom = T, widths = c(1,0.7,0.7,1.7,1,1))


figure_3_pacific_full_threelevels

ggsave(figure_3_pacific_full_threelevels, path = here::here("Figures", "Figure3_5"), filename = "Figure3_pacific_latitude_area_spprichness_threelevels.pdf", height = 6, width = 10, unit = "in")
ggsave(figure_3_pacific_full_threelevels, path = here::here("Figures", "Figure3_5"), filename = "Figure3_pacific_latitude_area_spprichness_threelevels.jpg", height = 6, width = 10, unit = "in")




```

#Indian

#East indian
```{r east indian plots}
#pull values from maps
west_ind_map <- ggplot_build(region_maps[[4]])
east_ind_map <- ggplot_build(region_maps[[6]])

(east_indian_spprichness <- ggplot(data = shelf_areas[region == "East Indian"], aes(x=latitude_start, y=change_spp_predicted_levin)) +
   geom_col(aes(fill=spp_change_pos_neg_levin), alpha = 0.5) +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression(Delta~'Species Richness')) +
  geom_vline(xintercept = 0) +
  coord_flip() +   
  scale_x_continuous(breaks = c(-60,-40,-20,0,20)) +
  theme_classic())

#with 3 levels and error bars
(east_indian_spprichness_errorbars <- ggplot(data = shelf_areas[region == "East Indian"], aes(x=latitude_start, y=log_abs_change_spp_predicted_38*spp_change_pos_neg_38)) +
   geom_col(aes(fill=spp_change_pos_neg_38_discrete), alpha = 0.5) +
  geom_errorbar(aes(ymin=log_abs_change_spp_predicted_175*spp_change_pos_neg_175, ymax=log_abs_change_spp_predicted_62*spp_change_pos_neg_62), size = 0.2, alpha = 0.6)  +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression('log'~Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

```

#West indian

```{r west indian plots}
(west_indian_spprichness <- ggplot(data = shelf_areas[region == "West Indian"], aes(x=latitude_start, y=change_spp_predicted_levin)) +
   geom_col(aes(fill=spp_change_pos_neg_levin), alpha = 0.5) +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression(Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) + scale_x_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30)) +
  coord_flip() +
  theme_classic())

#with 3 levels and error bars
(west_indian_spprichness_errorbars <- ggplot(data = shelf_areas[region == "West Indian"], aes(x=latitude_start, y=log_abs_change_spp_predicted_38*spp_change_pos_neg_38)) +
   geom_col(aes(fill=spp_change_pos_neg_38_discrete), alpha = 0.5) +
  geom_errorbar(aes(ymin=log_abs_change_spp_predicted_175*spp_change_pos_neg_175, ymax=log_abs_change_spp_predicted_62*spp_change_pos_neg_62), size = 0.2, alpha = 0.6)  +
    scale_fill_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Species Richness Change\nWith 2\u00B0 Latitudinal Shift", labels = c("Loss", "Gain")) +
    labs(x = "Depth  (15 m bins)", y = "Change in Spp Richness") +
 labs(x=paste0("Latitude ","\u00B0","N"), y = expression('log'~Delta~'Species Richness')) +
#  scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
#  scale_y_continuous(expand = c(0, 0)) +
  geom_vline(xintercept = 0) +
  coord_flip() +
  theme_classic())

```

#indian merge
```{r indian merge}

figure_5_indian_full <- egg::ggarrange(region_maps[[4]] + 
                                                theme(legend.position = "top",
                                                      axis.title.x = element_blank(),
                                                      plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"))+
   coord_equal(ylim = c(-38,32), xlim = c(10,83)) +
                                                scale_y_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30)),
          area_latitude_west_ind + 
               theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                     legend.position = "top",
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
      guides(color = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
            xlim(min(west_ind_map$data[[1]]$y), max(west_ind_map$data[[1]]$y)) +
                                                scale_x_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30))  +
   xlim(min(west_ind_map$data[[2]]$y), max(west_ind_map$data[[2]]$y)),
          west_indian_spprichness +
                           theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "top") +
      guides(fill = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
                                                scale_x_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30)),
 
 region_maps[[6]] + theme(legend.position = "none",
                          plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_y_continuous(breaks = c(-40,-20,0,20)) +  coord_equal(ylim = c(-43, 22), xlim = c(74,152)),
          area_latitude_east_ind + 
               theme(axis.text.y = element_blank(),
           #          axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     legend.position = "none",
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_x_continuous(breaks = c(-40,-20,0,20)) + xlim(c(-44,22)),
          east_indian_spprichness +
            theme(axis.text.y = element_blank(),
            #    axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "none") +
                                                 scale_x_continuous(breaks = c(-60,-40,-20,0,20)) + xlim(c(-44,22)),
 nrow = 2, top = T, bottom = T, left = T, right = T)


figure_5_indian_full

ggsave(figure_5_indian_full, path = here::here("Figures", "Figure3_5"), filename = "Figure5_indian_latitude_area_spprichness.pdf", height = 6, width = 10, unit = "in")
ggsave(figure_5_indian_full, path = here::here("Figures", "Figure3_5"), filename = "Figure5_indian_latitude_area_spprichness.jpg", height = 6, width = 10, unit = "in")

```

#indian merge for three levels
```{r indian merge three levels}

figure_5_indian_full_threelevels <- egg::ggarrange(region_maps[[4]] + 
                                                theme(legend.position = "top",
                                                      axis.title.x = element_blank(),
                                                      plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"))+
   coord_equal(ylim = c(-38,32), xlim = c(10,83)) +
                                                scale_y_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30)),
          area_latitude_west_ind + 
               theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                     legend.position = "top",
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
      guides(color = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
            xlim(min(west_ind_map$data[[1]]$y), max(west_ind_map$data[[1]]$y)) +
                                                scale_x_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30))  +
   xlim(min(west_ind_map$data[[2]]$y), max(west_ind_map$data[[2]]$y)),
          west_indian_spprichness_errorbars +
                           theme(axis.text.y = element_blank(),
                    # axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     axis.title.x = element_blank(),
                    legend.text=element_text(size=10),
                    legend.title=element_text(size=10),
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "top") +
      guides(fill = guide_legend(title.position = "top", title.hjust = 0.5,direction = "vertical")) +
                                                scale_x_continuous(breaks = c(-40,-30,-20,-10,0,10,20,30)),
 
 region_maps[[6]] + theme(legend.position = "none",
                          plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_y_continuous(breaks = c(-40,-20,0,20)) +  coord_equal(ylim = c(-43, 22), xlim = c(74,152)),
          area_latitude_east_ind + 
               theme(axis.text.y = element_blank(),
           #          axis.ticks.y = element_blank(),
                     axis.title.y = element_blank(),
                     legend.position = "none",
                     plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")) +
                                                scale_x_continuous(breaks = c(-40,-20,0,20)) + xlim(c(-44,22)),
          west_indian_spprichness_errorbars +
            theme(axis.text.y = element_blank(),
            #    axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm"),
                legend.position = "none") +
                                                 scale_x_continuous(breaks = c(-60,-40,-20,0,20)) + xlim(c(-44,22)),
 nrow = 2, top = T, bottom = T, left = T, right = T)


figure_5_indian_full_threelevels

ggsave(figure_5_indian_full_threelevels, path = here::here("Figures", "Figure3_5"), filename = "Figure5_indian_latitude_area_spprichness_threelevels.pdf", height = 6, width = 10, unit = "in")
ggsave(figure_5_indian_full_threelevels, path = here::here("Figures", "Figure3_5"), filename = "Figure5_indian_latitude_area_spprichness_threelevels.jpg", height = 6, width = 10, unit = "in")

```











#what if we tried a second y axes instead (I think I'm going to scrap this alternative attempt)
```{r}
#west atlantic

area_latitude_west_atl_2axes  <- ggplot() +
  geom_area(data = shelf_areas[region == "West Atlantic"], aes(x=latitude_mid, y=original_spp_predicted_levin), fill = "azure3") +
  geom_line(data = west_atl_north_data, aes(x=latitude_mid, y = area_1000s), color = "white", size = 0.8, linetype = "longdash") +
  geom_line(data = west_atl_south_data, aes(x=-latitude_mid, y = area_1000s), color = "white", size = 0.8, linetype = "longdash") +
  geom_point(data = west_atl_shelf_areas, aes(x=latitude_start, y=area_1000s), shape =18, size = 0.7) + 
  geom_line(data = west_atl_shelf_areas, aes(x=latitude_start, y=area_1000s), size = 0.7) +
  geom_rug(data = west_atl_shelf_areas_highlight, aes(x = latitude_start, color = as.factor(change_above_2fold))) +
 labs(x=paste0("Latitude ","\u00B0","E"), y = expression(paste("Area (1000s of ", km^{2},")"))) +
  scale_color_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Associated Change\nin Shelf Area", labels = c("Contraction", "Expansion")) +
  #annotate("text", x = 80, y = 120000, label = "Western Atlantic Ocean") +
  geom_vline(xintercept = 0) +
  scale_y_continuous(
    #expand = c(0, 0),
    # Add a second axis and specify its features
    sec.axis = sec_axis(trans = ~., name=paste0(expression(delta)," Species Richness"))) +
    scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
  coord_flip() +
  theme_classic() +
  theme(plot.margin = margin(10, 10, 10, 10), 
        axis.title.x.top = element_text(color = "azure4", face = "bold"),
        axis.text.x.top = element_text(color = "azure4", face = "bold"))
```

```{r}
#east atlantic

(area_latitude_east_atl_2axes  <- ggplot() +
  geom_area(data = shelf_areas[region == "East Atlantic"], aes(x=latitude_mid, y=original_spp_predicted_levin), fill = "azure3") +
  geom_line(data = east_atl_north_data, aes(x=latitude_mid, y = area_1000s), color = "orange4", size = 0.8, linetype = "longdash") +
  geom_line(data = east_atl_south_data, aes(x=-latitude_mid, y = area_1000s), color = "orange4", size = 0.8, linetype = "longdash") +
  geom_point(data = east_atl_shelf_areas, aes(x=latitude_start, y=area_1000s), shape =18, size = 0.7) + 
  geom_line(data = east_atl_shelf_areas, aes(x=latitude_start, y=area_1000s), size = 0.7) +
  geom_rug(data = east_atl_shelf_areas_highlight, aes(x = latitude_start, color = as.factor(change_above_2fold))) +
 labs(x=paste0("Latitude ","\u00B0","E"), y = expression(paste("Area (1000s of ", km^{2},")"))) +
  scale_color_viridis_d(option = "A", begin = 0.3, end = 0.7, name = "Associated Change\nin Shelf Area", labels = c("Contraction", "Expansion")) +
  #annotate("text", x = 80, y = 120000, label = "eastern Atlantic Ocean") +
  geom_vline(xintercept = 0) +
#  xlim(min(east_atl_shelf_areas$latitude_end), max(east_atl_shelf_areas$latitude_end)) +
  scale_y_continuous(
#    expand = c(0, 0),
    # Add a second axis and specify its features
    sec.axis = sec_axis(trans = ~., name=paste0(expression(delta)," Species Richness")),
     limits = c(0,max(east_atl_shelf_areas$area_1000s))) +
    scale_x_continuous(expand = c(0, 0)) + #gets rid of gap
  coord_flip() +
  theme_classic() +
# ylim(0,max(east_atl_shelf_areas$area_1000s)) +
  theme(plot.margin = margin(10, 10, 10, 10), 
        axis.title.x.top = element_text(color = "azure4", face = "bold"),
        axis.text.x.top = element_text(color = "azure4", face = "bold")))

#add map

east_atlantic_overlay <- egg::ggarrange(region_maps[[5]] + theme(plot.margin = unit(c(0.1,0.1,0.1,0.1),"cm")),
          area_latitude_east_atl_2axes, bottom = T, ncol = 2, nrow = 1)
```

#East Pacific

#West Pacific

#East Indian

#West Indian
