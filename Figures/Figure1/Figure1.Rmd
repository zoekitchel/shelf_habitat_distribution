---
title: "Figure 1 Code"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r setup}
library(ggplot2)
library(data.table)
library(cowplot)
library(here)
library(scales)
```

```{r load data}
lme_areaplots_classified <- readRDS(here::here("output","compiled_plots","arranged_areaplots_classified.rds"))
lme_maps <- readRDS(here::here("output","compiled_plots","lme_maps.rds"))
lme_spp_count_area_change_mean <- readRDS(here::here("output","compiled_plots","lme_spp_count_area_change_mean.rds"))
LME_bathy_statistics_full <- readRDS(here::here("output","LME_bathy_statistics_full.rds"))

```

```{r plot maps in row}

plot_grid(lme_maps[[4]] + theme(legend.position = "none"),
          lme_maps[[21]] +  theme(legend.position = "none"),
          lme_maps[[29]] +  theme(legend.position = "none"),
          get_legend(lme_maps[[4]]),
          ncol = 4, nrow = 1, rel_widths = c(1,1,1,0.3))


```

```{r plot hypsometric curves in row}

lme_areaplots_figure1 <- list()

for (i in c(4,21,29)) {
  #get max y value to set label location
  ggp <- ggplot_build(lme_areaplots_classified[[i]])
max_y <- ggp$layout$panel_scales_y[[1]]$range$range[[2]]  #y range
  
#full plot
  lme_areaplots_figure1[[i]] <- lme_areaplots_classified[[i]] +
geom_vline(xintercept = LME_bathy_statistics_full[i,mean_depth], color = "red") +
    annotate("text", x =  Inf, y = max_y+max_y/20, hjust = 1, label = paste0("\n",LME_bathy_statistics_full[i,region]," Ocean"), size = 3) +
        annotate("text", x=Inf, y = max_y-max_y/20, hjust=1, label = paste0("Classification: ", LME_bathy_statistics_full[i,type]), size = 3) +
    annotate("text", x=Inf, y = max_y-2*max_y/20, hjust=1, label = paste0("Dip Test: ", signif(LME_bathy_statistics_full[i,dip_test],2), " P-value = ", signif(LME_bathy_statistics_full[i,dip_p_value], 2)), size = 3) +
    annotate("text", x=Inf, y = max_y-3*max_y/20, hjust=1, label = paste0("Skew: ", round(LME_bathy_statistics_full[i,skew],2)), size = 3) +
    annotate("text", x=Inf, y = max_y-4*max_y/20, hjust=1, label = paste0("Mean: ",round(LME_bathy_statistics_full[i,mean_depth],2), " m"), size = 3) +
    theme(axis.title = element_text(size = 11), axis.text = element_text(size = 9),
            legend.title = element_text(size = 11),
            legend.text = element_text(size = 9)) +
    guides(shape = guide_legend(override.aes = list(size = 7)))

}


plot_grid(lme_areaplots_classified[[4]] + theme(legend.position = "bottom"),
          lme_areaplots_classified[[21]] +  theme(legend.position = "bottom"),
          lme_areaplots_classified[[29]] +  theme(legend.position = "bottom"),
          ncol = 4, nrow = 1, rel_widths = c(1,1,1,0.3)) 
```

Map and hypsometric 
```{r}
figure1_map_hyp <- plot_grid(lme_maps[[4]] + ylab(paste0("Latitude ","\u00B0","N")) + xlab(paste0("Longitude ","\u00B0","E")) + theme(legend.position = "none"),
          lme_maps[[21]] +  ylab(paste0("Latitude ","\u00B0","N")) + xlab(paste0("Longitude ","\u00B0","E")) + theme(legend.position = "none", axis.title.y = element_blank()),
          lme_maps[[29]] +  ylab(paste0("Latitude ","\u00B0","N")) + xlab(paste0("Longitude ","\u00B0","E")) + theme(legend.position = "none", axis.title.y = element_blank()),
          lme_areaplots_figure1[[4]] + theme(legend.position = "none"),
          lme_areaplots_figure1[[21]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          lme_areaplots_figure1[[29]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          ncol = 3, nrow = 2,
          align = c("hv"), axis = c("lr"))

figure1_map_hyp.legend <- plot_grid(figure1_map_hyp, get_legend(lme_maps[[4]]), ncol = 2, nrow = 1, rel_widths = c(10,1))
```

Richness
```{r change in richness by lme}
plot_grid(lme_spp_count_area_change_mean[[4]] + theme(legend.position = "none"),
          lme_spp_count_area_change_mean[[21]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          lme_spp_count_area_change_mean[[29]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          get_legend(lme_spp_count_area_change_mean[[29]] + theme(legend.title = element_text(size = 10), legend.text = element_text(size = 10))),
          ncol = 4, nrow = 1, rel_widths = c(1,1,1,1)) 



```

All nine plots together
```{r}
figure1_map_hyp_richness <- plot_grid(lme_maps[[4]] + ylab(paste0("Latitude ","\u00B0","N")) + xlab(paste0("Longitude ","\u00B0","E")) + theme(legend.position = "bottom", plot.margin = ggplot2::margin(1,0,0,0,unit = "cm"), legend.text = element_text(size = 5, angle = 90), legend.title = element_text(size = 6), legend.key.height = unit(0.3, "cm"), legend.spacing.y = unit(3, 'mm')),
          lme_maps[[21]] +  ylab(paste0("Latitude ","\u00B0","N")) + xlab(paste0("Longitude ","\u00B0","E")) + theme(axis.title.y = element_blank(), legend.position = "bottom", plot.margin = ggplot2::margin(1,0,0,0,unit = "cm"), legend.text = element_text(size = 5, angle = 90), legend.title = element_text(size = 6), legend.key.height = unit(0.3, "cm"), legend.spacing.y = unit(3, 'mm')),
          lme_maps[[29]] +  ylab(paste0("Latitude ","\u00B0","N")) + xlab(paste0("Longitude ","\u00B0","E")) + theme(axis.title.y = element_blank(), legend.position = "bottom", plot.margin = ggplot2::margin(1,0,0,0,unit = "cm"), legend.text = element_text(size = 5, angle = 90), legend.title = element_text(size = 6), legend.key.height = unit(0.3, "cm"), legend.spacing.y = unit(3, 'mm')),
          lme_areaplots_classified[[4]] + theme(legend.position = "none"),
          lme_areaplots_classified[[21]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          lme_areaplots_classified[[29]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          lme_spp_count_area_change_mean[[4]] + theme(legend.position = "none"),
          lme_spp_count_area_change_mean[[21]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          lme_spp_count_area_change_mean[[29]] +  theme(legend.position = "none", axis.title.y = element_blank()),
          ncol = 3, nrow = 3, 
          labels = c("Shallow Dominant","Multimodal","Mid Dominant","","","","","",""), 
          hjust = -0.5, label_size = 14, label_fontface = "bold", 
          align = "hv",
          rel_heights = c(8,8,8,2,2,2,4,4,4))

figure1_map_hyp_rich.legend <- plot_grid(figure1_map_hyp_richness, get_legend(lme_spp_count_area_change_mean[[4]] + theme(legend.position = "bottom",legend.title = element_blank(), legend.text = element_text(size = 11))),
                                         ncol = 1, nrow = 2, rel_heights = c(7,1))

ggsave(figure1_map_hyp_rich.legend, height = 13, width = 9, unit = "in", path = here::here("Figures","Figure1"), filename = "figure1_map_hyp_rich.legend.jpg")
ggsave(figure1_map_hyp_rich.legend, height = 13, width = 9, unit = "in", path = here::here("Figures","Figure1"), filename = "figure1_map_hyp_rich.legend.pdf")
```

